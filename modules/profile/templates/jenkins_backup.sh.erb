#!/usr/bin/env bash

backups_path="<%= scope.function_hiera(['profile::jenkins_master::cron_backup_path']) %>"
archive_date=$(date +%d%m%y%k%M%S)
backup_file="jenkins_home_$archive_date.tar"
full_backup_path="$backups_path/$backup_file"
jenkins_home_path="<%= scope.function_hiera(['profile::jenkins_master::jenkins_home_path']) %>"

cd $jenkins_home_path
tar -cvf $full_backup_path .
aws s3 cp $full_backup_path s3://jacderida-jenkins-backups/$backup_file
